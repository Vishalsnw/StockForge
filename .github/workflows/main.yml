name: StockForge Fix

on:
  workflow_dispatch:
    inputs:
      user_name:
        description: Target User
        required: false
        default: Vishalsnw
        type: string
      
  push:
    branches: 
      - main

jobs:
  fix-issues:
    name: Fix Issues
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Fix Loading Issues
        run: |
          echo "Fixing loading issues for Vishalsnw"
          echo "Time: 2025-06-12 14:48:43 UTC"
          
          HOOK_FILE="frontend/src/hooks/useBotMarket.js"
          
          if [ -f "$HOOK_FILE" ]; then
            echo "Fixing hook variables..."
            
            # Fix undefined variables
            sed -i 's/currentUser}/CURRENT_USER}/g' "$HOOK_FILE"
            sed -i 's/for ${currentUser}/for ${CURRENT_USER}/g' "$HOOK_FILE"
            sed -i 's/currentDateTimeUTC}/SESSION_START_TIME}/g' "$HOOK_FILE"
            sed -i 's/at ${currentDateTimeUTC}/at ${SESSION_START_TIME}/g' "$HOOK_FILE"
            
            echo "Hook fixed"
          fi
          
          HTML_FILE="frontend/index.html"
          if [ -f "$HTML_FILE" ]; then
            echo "Updating HTML timestamp..."
            sed -i 's/2025-06-11 21:40:11/2025-06-12 14:48:43/g' "$HTML_FILE"
            echo "HTML updated"
          fi

      - name: Build Test
        run: |
          cd frontend
          npm install
          npm run build

      - name: Commit
        run: |
          git config user.email "action@github.com"
          git config user.name "Bot"
          
          git add .
          
          if ! git diff --staged --quiet; then
            git commit -m "Fix loading issues - Vishalsnw - 2025-06-12 14:48:43"
            git push
          fi

      - name: Summary
        run: |
          echo "Fix completed for Vishalsnw"
          echo "Time: 2025-06-12 14:48:43 UTC"
          echo "Loading should work now"
