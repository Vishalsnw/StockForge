name: Fix Missing Dependencies

on:
  workflow_dispatch:
    inputs:
      user_name:
        description: Target User
        required: false
        default: Vishalsnw
        type: string

jobs:
  fix-dependencies:
    name: Fix Dependencies
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Install Missing Dependencies
        run: |
          cd frontend
          
          echo "Installing missing dependencies for StockForge..."
          
          # Install React Router
          npm install react-router-dom@6.26.1
          
          # Install other missing dependencies that App.jsx might need
          npm install @heroicons/react@2.0.18
          npm install lucide-react@0.441.0
          npm install recharts@2.8.0
          npm install framer-motion@10.16.16
          
          echo "Dependencies installed"

      - name: Simplify App.jsx for Basic Version
        run: |
          echo "Creating simplified App.jsx without complex routing..."
          
          cat > frontend/src/App.jsx << 'EOF'
          // ===== STOCKFORGE SIMPLIFIED APP.JSX =====
          // ===== MAIN APPLICATION COMPONENT (SIMPLIFIED) =====
          
          // üéØ Built for: Vishalsnw
          // üìÖ Created: 2025-06-12 15:18:24 UTC
          // üöÄ Version: 2.2.0 (Simplified)
          // üìç Path: src/App.jsx
          
          import React, { useState, useEffect } from 'react';
          import MarketDashboard from './components/MarketDashboard/MarketDashboard.jsx';
          import './App.css';
          
          // ===== CURRENT SESSION INFO =====
          const CURRENT_USER = 'Vishalsnw';
          const CREATED_AT = '2025-06-12 15:18:24';
          const BUILD_VERSION = '2.2.0';
          
          function App() {
            // ===== APPLICATION STATE =====
            const [isAppReady, setIsAppReady] = useState(false);
            const [currentTime, setCurrentTime] = useState('');
            const [sessionStartTime] = useState(new Date().toISOString().replace('T', ' ').substring(0, 19));
          
            // ===== SESSION INITIALIZATION =====
            useEffect(() => {
              console.log('üè¶ StockForge Market Game - App Component Initializing');
              console.log(`üë§ User: ${CURRENT_USER}`);
              console.log(`üïí App Started: ${CREATED_AT} UTC`);
              console.log(`üöÄ Version: ${BUILD_VERSION}`);
              console.log(`üìç Component: src/App.jsx`);
              
              // Initialize app
              setTimeout(() => {
                setIsAppReady(true);
                console.log(`‚úÖ App ready for ${CURRENT_USER} at ${sessionStartTime}`);
              }, 1000);
          
              // Update current time every second
              const timeInterval = setInterval(() => {
                const now = new Date();
                setCurrentTime(now.toISOString().replace('T', ' ').substring(0, 19));
              }, 1000);
          
              return () => {
                clearInterval(timeInterval);
                console.log(`üßπ App cleanup completed for ${CURRENT_USER}`);
              };
            }, [sessionStartTime]);
          
            // ===== LOADING STATE =====
            if (!isAppReady) {
              return (
                <div className="app-loading">
                  <div className="loading-container">
                    <div className="loading-logo">
                      <h1>üè¶ StockForge</h1>
                      <p>Market Game Engine</p>
                    </div>
                    <div className="loading-spinner">
                      <div className="spinner"></div>
                    </div>
                    <div className="loading-info">
                      <p>üë§ Welcome {CURRENT_USER}</p>
                      <p>üïí Initializing at {CREATED_AT} UTC</p>
                      <p>üöÄ Loading Market Data...</p>
                    </div>
                  </div>
                </div>
              );
            }
          
            // ===== MAIN APPLICATION RENDER =====
            return (
              <div className="App">
                {/* ===== APP HEADER ===== */}
                <header className="app-header">
                  <div className="header-container">
                    <div className="header-left">
                      <h1>üè¶ StockForge</h1>
                      <span className="version">v{BUILD_VERSION}</span>
                    </div>
                    
                    <div className="header-center">
                      <div className="market-status">
                        <span className="status-indicator active"></span>
                        <span className="status-text">Market Open</span>
                      </div>
                    </div>
                    
                    <div className="header-right">
                      <div className="user-info">
                        <span className="user-name">üë§ {CURRENT_USER}</span>
                        <span className="current-time">üïí {currentTime} UTC</span>
                      </div>
                    </div>
                  </div>
                </header>
          
                {/* ===== MAIN CONTENT AREA ===== */}
                <main className="app-main">
                  <div className="main-container">
                    
                    {/* ===== SESSION INFO BANNER ===== */}
                    <div className="session-banner">
                      <div className="session-info">
                        <span>üìÖ Session Started: {sessionStartTime} UTC</span>
                        <span>üéØ Built for: {CURRENT_USER}</span>
                        <span>üöÄ StockForge Market Game Ready!</span>
                      </div>
                    </div>
          
                    {/* ===== MARKET DASHBOARD COMPONENT ===== */}
                    <div className="dashboard-container">
                      <MarketDashboard 
                        user={CURRENT_USER}
                        sessionStart={sessionStartTime}
                        appVersion={BUILD_VERSION}
                      />
                    </div>
          
                    {/* ===== FOOTER INFO ===== */}
                    <div className="app-footer">
                      <div className="footer-content">
                        <div className="footer-left">
                          <span>üéÆ StockForge Market Game</span>
                          <span>üì¶ Version {BUILD_VERSION}</span>
                        </div>
                        <div className="footer-center">
                          <span>üïí Live Time: {currentTime} UTC</span>
                        </div>
                        <div className="footer-right">
                          <span>üë§ User: {CURRENT_USER}</span>
                          <span>üè¶ Trading Platform Active</span>
                        </div>
                      </div>
                    </div>
          
                  </div>
                </main>
              </div>
            );
          }
          
          // ===== COMPONENT EXPORT =====
          export default App;
          
          // ===== FINAL SESSION LOG =====
          console.log(`üéØ App.jsx component ready for ${CURRENT_USER} at 2025-06-12 15:18:24 UTC`);
          console.log(`üì¶ Features: Header, Dashboard Integration, Session Management`);
          console.log(`üöÄ Ready for production deployment!`);
          EOF
          
          echo "Simplified App.jsx created"

      - name: Test Build
        run: |
          cd frontend
          npm install
          npm run build

      - name: Commit Changes
        run: |
          git config user.email "action@github.com"
          git config user.name "Bot"
          
          git add .
          
          if ! git diff --staged --quiet; then
            git commit -m "Fix: Install dependencies and simplify App.jsx - Vishalsnw - 2025-06-12 15:18:24"
            git push
            echo "Changes committed and pushed"
          else
            echo "No changes to commit"
          fi

      - name: Success Summary
        run: |
          echo "DEPENDENCY FIX COMPLETED"
          echo "======================="
          echo "User: Vishalsnw"
          echo "Time: 2025-06-12 15:18:24 UTC"
          echo ""
          echo "Fixes Applied:"
          echo "- Installed react-router-dom and other dependencies"
          echo "- Simplified App.jsx (removed complex routing)"
          echo "- Kept core functionality working"
          echo "- Build should now succeed"
          echo ""
          echo "StockForge app ready for deployment!"
