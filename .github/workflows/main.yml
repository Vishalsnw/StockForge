name: 🔧 Auto Fix useBotMarket.js

on:
  workflow_dispatch:

jobs:
  fix-usebotmarket:
    runs-on: ubuntu-latest
    steps:
      - name: ⬇️ Checkout repo
        uses: actions/checkout@v4

      - name: 🛠️ Auto-fix undefined vars
        run: |
          TARGET="src/hooks/useBotMarket.js"

          echo "🔍 Fixing $TARGET"

          if [ ! -f "$TARGET" ]; then
            echo "❌ $TARGET not found"
            exit 1
          fi

          # Fix undefined 'currentDateTimeUTC' → replace with getCurrentTime()
          sed -i "s/\bcurrentDateTimeUTC\b/getCurrentTime()/g" "$TARGET"

          # Fix undefined 'currentDate' → replace with sessionStartTime.split(' ')[0]
          sed -i "s/\bcurrentDate\b/sessionStartTime.split(' ')[0]/g" "$TARGET"

          echo "✅ Variables replaced in $TARGET"

      - name: ✅ Commit and push fix
        run: |
          git config user.name "StockForge Auto-Fix Bot"
          git config user.email "action@github.com"

          git add src/hooks/useBotMarket.js
          git commit -m "🚑 Auto-fix undefined vars in useBotMarket.js"
          git push
